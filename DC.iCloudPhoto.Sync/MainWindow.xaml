<Window x:Class="DC.iCloudPhoto.Sync.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="iCloud 照片同步"
        Height="720"
        Width="1100"
        MinHeight="600"
        MinWidth="960"
        Background="#FFF5F7FB">
    <Window.Resources>
        <Style x:Key="SectionCardStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="12" />
            <Setter Property="Margin" Value="0,0,0,16" />
            <Setter Property="BorderBrush" Value="#FFE2E8F0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Background" Value="White" />
        </Style>
        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,0,0,4" />
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="24">
                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                <TextBlock Text="源文件夹" Style="{StaticResource LabelStyle}" />
                                <TextBox Text="{Binding SourceFolder, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="目标文件夹" Style="{StaticResource LabelStyle}" />
                                <TextBox Text="{Binding TargetFolder, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>
                        </Grid>
                        <TextBlock Text="筛选条件" Style="{StaticResource LabelStyle}" />
                        <Grid Margin="0,4,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0" Margin="0,0,12,0">
                                <TextBlock Text="开始时间" />
                                <DatePicker SelectedDate="{Binding StartDate}" />
                            </StackPanel>
                            <StackPanel Grid.Column="1" Margin="0,0,12,0">
                                <TextBlock Text="结束时间" />
                                <DatePicker SelectedDate="{Binding EndDate}" />
                            </StackPanel>
                            <StackPanel Grid.Column="2">
                                <TextBlock Text="类型" />
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <CheckBox Content="JPG"
                                              IsChecked="{Binding IncludeJpg}"
                                              Margin="0,0,16,0" />
                                    <CheckBox Content="MP4"
                                              IsChecked="{Binding IncludeMp4}"
                                              Margin="0,0,16,0" />
                                    <CheckBox Content="MOV"
                                              IsChecked="{Binding IncludeMov}" />
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <DockPanel Margin="0,0,0,8">
                            <TextBlock Text="同步预览" FontSize="16" FontWeight="Bold" DockPanel.Dock="Left" />
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" DockPanel.Dock="Right">
                                <Button Content="上一页"
                                        Width="80"
                                        Margin="0,0,8,0"
                                        Click="OnPrevPageClicked"
                                        IsEnabled="{Binding IsNotBusy}" />
                                <Button Content="下一页"
                                        Width="80"
                                        Margin="0,0,12,0"
                                        Click="OnNextPageClicked"
                                        IsEnabled="{Binding IsNotBusy}" />
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,12,0">
                                    <TextBlock Text="每页" Margin="0,0,4,0" VerticalAlignment="Center" />
                                    <ComboBox ItemsSource="{Binding PageSizeOptions}"
                                              SelectedItem="{Binding PageSize}"
                                              Width="80"
                                              IsEnabled="{Binding IsNotBusy}" />
                                </StackPanel>
                                <TextBlock Text="{Binding PageSummary}" VerticalAlignment="Center" />
                            </StackPanel>
                        </DockPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                            <TextBlock Text="显示状态：" VerticalAlignment="Center" Margin="0,0,12,0" FontWeight="SemiBold" />
                            <CheckBox Content="等待同步"
                                      IsChecked="{Binding ShowPendingCopy}"
                                      Margin="0,0,16,0"
                                      IsEnabled="{Binding IsNotBusy}" />
                            <CheckBox Content="已存在"
                                      IsChecked="{Binding ShowUpToDate}"
                                      Margin="0,0,16,0"
                                      IsEnabled="{Binding IsNotBusy}" />
                            <CheckBox Content="仅目标存在"
                                      IsChecked="{Binding ShowTargetOnly}"
                                      IsEnabled="{Binding IsNotBusy}" />
                        </StackPanel>

                        <TextBlock Text="{Binding StatisticsSummary}"
                                   Margin="0,0,0,8"
                                   FontStyle="Italic"
                                   Foreground="#FF64748B" />

                        <DataGrid ItemsSource="{Binding PagedItems}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  CanUserAddRows="False"
                                  Height="360"
                                  AlternatingRowBackground="#FFF1F5F9"
                                  GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column">
                            <DataGrid.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="在源文件夹中打开" Click="OnOpenSourceFolderClicked" />
                                    <MenuItem Header="在目标文件夹中打开" Click="OnOpenTargetFolderClicked" />
                                </ContextMenu>
                            </DataGrid.ContextMenu>
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="状态" Binding="{Binding StatusLabel}" Width="120" />
                                <DataGridTextColumn Header="文件名" Binding="{Binding FileName}" Width="*" />
                                <DataGridTextColumn Header="源时间" Binding="{Binding SourceModified, StringFormat=yyyy-MM-dd HH:mm:ss}" Width="170" />
                                <DataGridTextColumn Header="目标时间" Binding="{Binding TargetModified, StringFormat=yyyy-MM-dd HH:mm:ss}" Width="170" />
                                <DataGridTextColumn Header="源大小(MB)" Binding="{Binding SourceSizeMB}" Width="120" />
                                <DataGridTextColumn Header="目标大小(MB)" Binding="{Binding TargetSizeMB}" Width="120" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <Border Style="{StaticResource SectionCardStyle}">
                    <StackPanel>
                        <DockPanel LastChildFill="True">
                            <TextBlock Text="操作日志" FontSize="16" FontWeight="Bold" DockPanel.Dock="Left" />
                            <Button Content="清空"
                                    Width="80"
                                    DockPanel.Dock="Right"
                                    Click="OnClearLogClicked"
                                    IsEnabled="{Binding IsNotBusy}" />
                        </DockPanel>
                        <TextBox Margin="0,12,0,0"
                                 Text="{Binding LogText, Mode=OneWay}"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 Height="180"
                                 IsReadOnly="True" />
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <Border Grid.Row="1" Background="White" Padding="24">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="预览"
                        Width="120"
                        Margin="0,0,12,0"
                        Click="OnPreviewClicked"
                        IsEnabled="{Binding IsNotBusy}" />
                <Button Content="开始同步"
                        Width="140"
                        Click="OnSyncClicked"
                        IsEnabled="{Binding CanSync}" />
            </StackPanel>
        </Border>
    </Grid>
</Window>
